<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>LLM Prompt Manager</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ¤– LLM Prompt Manager</h1>
      <button id="settingsBtn" class="btn-icon" title="Settings">âš™ï¸</button>
    </div>

    <!-- Settings Panel (hidden by default) -->
    <div id="settingsPanel" class="settings-panel" style="display: none;">
      <h2>âš™ï¸ Settings</h2>

      <div class="setting-item">
        <label class="toggle-container">
          <input type="checkbox" id="darkModeToggle">
          <span class="toggle-slider"></span>
          <span class="toggle-label">ğŸŒ™ Dark Mode</span>
        </label>
      </div>

      <div class="setting-item">
        <label class="toggle-container">
          <input type="checkbox" id="autoThemeToggle">
          <span class="toggle-slider"></span>
          <span class="toggle-label">ğŸŒ— Auto Theme (System)</span>
        </label>
      </div>

      <div class="setting-item">
        <button id="templatesBtn" class="btn-secondary">ğŸ“š Browse Templates</button>
      </div>

      <div class="setting-item">
        <button id="analyticsBtn" class="btn-secondary">ğŸ“Š View Analytics</button>
      </div>

      <div class="setting-item">
        <button id="chainsBtn" class="btn-secondary">ğŸ”— Manage Chains</button>
      </div>

      <div class="setting-item">
        <button id="branchesBtn" class="btn-secondary">ğŸŒ³ Conversation Branches</button>
      </div>

      <div class="setting-item">
        <button id="apiSettingsBtn" class="btn-secondary">ğŸ”‘ API Settings</button>
      </div>

      <div class="setting-item">
        <button id="closeSettingsBtn" class="btn-primary">Close</button>
      </div>
    </div>

    <!-- Search Bar -->
    <div class="search-section">
      <input type="text" id="searchInput" placeholder="ğŸ” Search prompts..." />
      <button id="bulkModeToggle" class="btn-bulk-mode">Select Multiple</button>
    </div>

    <!-- Bulk Actions Bar (hidden by default) -->
    <div id="bulkActionsBar" class="bulk-actions-bar" style="display: none;">
      <span id="bulkSelectedCount">0 selected</span>
      <select id="bulkMoveFolder" class="bulk-folder-select">
        <option value="">Move to folder...</option>
      </select>
      <button id="bulkMoveBtn" class="btn-bulk-action">Move Selected</button>
      <button id="bulkDeleteBtn" class="btn-bulk-action btn-danger">Delete Selected</button>
      <button id="bulkCancelBtn" class="btn-bulk-action">Cancel</button>
    </div>

    <!-- Recently Used Section -->
    <div class="recent-section collapsible-section" id="recentSection" style="display: none;">
      <div class="section-header" data-section="recent">
        <h2>âš¡ Recently Used</h2>
        <span class="collapse-icon">â–¼</span>
      </div>
      <div class="section-content" id="recentContent">
        <div id="recentPromptsList" class="recent-prompts-list"></div>
      </div>
    </div>

    <!-- Favorites Section -->
    <div class="favorites-section collapsible-section" id="favoritesSection" style="display: none;">
      <div class="section-header" data-section="favorites">
        <h2>â­ Favorites</h2>
        <span class="collapse-icon">â–¼</span>
      </div>
      <div class="section-content" id="favoritesContent">
        <div id="favoritePromptsList" class="favorites-prompts-list"></div>
      </div>
    </div>

    <!-- Folders Section -->
    <div class="folder-section collapsible-section">
      <div class="section-header" data-section="folders">
        <h2>ğŸ“ Folders</h2>
        <span class="collapse-icon">â–¼</span>
      </div>
      <div class="section-content" id="foldersContent">
        <div class="folder-management">
          <input type="text" id="newFolderName" placeholder="New folder name..." />
          <button id="addFolder" class="btn-folder">+ Add Folder</button>
        </div>
        <div id="foldersList" class="folders-list"></div>
      </div>
    </div>

    <!-- Add Prompt Section with Copilot -->
    <div class="add-section">
      <div class="section-header-with-toggle">
        <h2>Add New Prompt</h2>
        <label class="toggle-container-inline">
          <input type="checkbox" id="copilotToggle">
          <span class="toggle-slider-small"></span>
          <span class="toggle-label-small">ğŸ¤– Copilot</span>
        </label>
      </div>

      <select id="promptFolder" class="folder-select">
        <option value="">Select folder...</option>
      </select>

      <input type="text" id="promptName" placeholder="Prompt name (e.g., 'Scrutinize Answer')" />

      <!-- Task Type Selector (for smart routing) -->
      <select id="taskTypeSelect" class="task-type-select">
        <option value="general">General Task</option>
        <option value="code">Code/Programming</option>
        <option value="writing">Writing/Content</option>
        <option value="reasoning">Analysis/Reasoning</option>
        <option value="creative">Creative</option>
      </select>

      <textarea id="promptText" placeholder="Enter your prompt here... Use {{variable}} for variables"></textarea>

      <!-- Real-time Quality Feedback -->
      <div id="qualityFeedback" class="quality-feedback" style="display: none;">
        <div class="quality-header">
          <span class="quality-grade">Grade: <strong id="qualityGrade">-</strong></span>
          <span class="quality-score">Score: <strong id="qualityScore">-</strong></span>
          <span class="quality-tokens">Tokens: <strong id="qualityTokens">-</strong></span>
          <span class="quality-cost">Est. Cost: <strong id="qualityCost">$-</strong></span>
        </div>
        <div id="qualityIssues" class="quality-issues"></div>
        <div id="qualitySuggestions" class="quality-suggestions"></div>
      </div>

      <!-- Copilot Suggestions Panel -->
      <div id="copilotPanel" class="copilot-panel" style="display: none;">
        <div class="copilot-header">
          <strong>ğŸ¤– Copilot Suggestions</strong>
          <button id="closeCopilot" class="btn-icon-small">Ã—</button>
        </div>
        <div id="copilotSuggestions" class="copilot-suggestions"></div>
      </div>

      <!-- Model Router Info -->
      <div id="modelRouterInfo" class="model-router-info" style="display: none;">
        <div class="router-header">
          <span>Recommended Model: <strong id="recommendedModel">-</strong></span>
          <button id="showModelOptions" class="btn-link">See alternatives</button>
        </div>
        <div id="modelDetails" class="model-details" style="display: none;"></div>
      </div>

      <!-- Action Buttons -->
      <div class="prompt-actions">
        <button id="addPrompt" class="btn-primary">Add Prompt</button>
        <button id="improvePrompt" class="btn-secondary" style="display: none;">âœ¨ Improve</button>
        <button id="compressPrompt" class="btn-secondary" style="display: none;">ğŸ—œï¸ Compress</button>
        <button id="scanSecurity" class="btn-secondary" style="display: none;">ğŸ”’ Security Scan</button>
      </div>
    </div>

    <!-- Prompts List Section -->
    <div class="prompts-section">
      <div class="prompts-header">
        <h2>Your Prompts</h2>
        <select id="filterFolder" class="folder-filter">
          <option value="all">All Folders</option>
        </select>
      </div>
      <div id="promptsList"></div>
      <div id="emptyState" class="empty-state">
        No prompts saved yet. Add one above!
      </div>
    </div>

    <!-- Trash Section -->
    <div class="trash-section" id="trashSection" style="display: none;">
      <h2>ğŸ—‘ï¸ Trash</h2>
      <button id="viewTrashBtn" class="btn-secondary">View Trash</button>
      <div id="trashList" style="display: none;"></div>
    </div>

    <!-- Backup & Restore Section -->
    <div class="backup-section">
      <h2>Backup & Restore</h2>

      <div class="auto-backup-toggle">
        <label class="toggle-container">
          <input type="checkbox" id="autoBackupToggle">
          <span class="toggle-slider"></span>
          <span class="toggle-label">Auto-backup to Downloads folder</span>
        </label>
        <p class="toggle-info">Automatically saves backups when prompts change. Sync this folder with Dropbox/Google Drive!</p>
      </div>

      <div class="backup-buttons">
        <button id="exportPrompts" class="btn-secondary">ğŸ“¥ Export Prompts</button>
        <button id="importPrompts" class="btn-secondary">ğŸ“¤ Import Prompts</button>
        <button id="sharePromptsBtn" class="btn-secondary">ğŸ”— Share Prompts</button>
        <button id="importFromCodeBtn" class="btn-secondary">ğŸ“ Import from Code</button>
      </div>
      <input type="file" id="fileInput" accept=".json" style="display: none;">
      <p class="backup-info">Export your prompts to backup or share. Import to restore from a backup.</p>
    </div>
  </div>

  <!-- Edit Modal -->
  <div id="editModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Edit Prompt</h2>
        <span class="modal-close">&times;</span>
      </div>
      <div class="modal-body">
        <label>Prompt Name:</label>
        <input type="text" id="editPromptName" class="modal-input" />

        <label>Folder:</label>
        <select id="editPromptFolder" class="modal-select"></select>

        <label>Prompt Text:</label>
        <textarea id="editPromptText" class="modal-textarea"></textarea>

        <div class="modal-info">
          <small>Use {{variable}} syntax for reusable variables</small>
        </div>
      </div>
      <div class="modal-footer">
        <button id="saveEditBtn" class="btn-primary">Save Changes</button>
        <button id="cancelEditBtn" class="btn-secondary">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Variable Input Modal -->
  <div id="variableModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Fill in Variables</h2>
        <span class="modal-close">&times;</span>
      </div>
      <div class="modal-body" id="variableInputs"></div>
      <div class="modal-footer">
        <button id="insertWithVariablesBtn" class="btn-primary">Insert Prompt</button>
        <button id="cancelVariablesBtn" class="btn-secondary">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Share Modal -->
  <div id="shareModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Share Prompts</h2>
        <span class="modal-close">&times;</span>
      </div>
      <div class="modal-body">
        <p>Share this code with others to import your prompts:</p>
        <textarea id="shareCode" class="share-code-textarea" readonly></textarea>
        <div id="qrCodeContainer" style="text-align: center; margin-top: 15px;"></div>
      </div>
      <div class="modal-footer">
        <button id="copyShareCodeBtn" class="btn-primary">Copy Code</button>
        <button id="closeShareBtn" class="btn-secondary">Close</button>
      </div>
    </div>
  </div>

  <!-- Import from Code Modal -->
  <div id="importCodeModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Import from Code</h2>
        <span class="modal-close">&times;</span>
      </div>
      <div class="modal-body">
        <p>Paste the share code here:</p>
        <textarea id="importCodeInput" class="share-code-textarea" placeholder="Paste code here..."></textarea>
      </div>
      <div class="modal-footer">
        <button id="importCodeBtn" class="btn-primary">Import</button>
        <button id="cancelImportCodeBtn" class="btn-secondary">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Templates Library Modal -->
  <div id="templatesModal" class="modal" style="display: none;">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2>ğŸ“š Prompt Templates Library</h2>
        <span class="modal-close">&times;</span>
      </div>
      <div class="modal-body">
        <p class="modal-description">Choose from pre-built prompt templates to get started quickly!</p>
        <div id="templatesList" class="templates-list"></div>
      </div>
      <div class="modal-footer">
        <button id="closeTemplatesBtn" class="btn-secondary">Close</button>
      </div>
    </div>
  </div>

  <!-- Analytics Dashboard Modal -->
  <div id="analyticsModal" class="modal" style="display: none;">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2>ğŸ“Š Usage Analytics</h2>
        <span class="modal-close">&times;</span>
      </div>
      <div class="modal-body">
        <div id="analyticsContent">
          <div class="analytics-stat">
            <h3>ğŸ“ˆ Most Used Prompts</h3>
            <div id="topPromptsList"></div>
          </div>
          <div class="analytics-stat">
            <h3>â­ Favorites</h3>
            <div id="favoritesCount"></div>
          </div>
          <div class="analytics-stat">
            <h3>ğŸ“Š Total Usage</h3>
            <div id="totalUsage"></div>
          </div>
          <div class="analytics-stat">
            <h3>ğŸ‘ Top Rated Prompts</h3>
            <div id="topRatedList"></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="closeAnalyticsBtn" class="btn-secondary">Close</button>
      </div>
    </div>
  </div>

  <!-- Prompt Chains Modal -->
  <div id="chainsModal" class="modal" style="display: none;">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2>ğŸ”— Prompt Chains</h2>
        <span class="modal-close">&times;</span>
      </div>
      <div class="modal-body">
        <div class="chains-section">
          <button id="createChainBtn" class="btn-primary" style="width: 100%; margin-bottom: 16px;">+ Create New Chain</button>
          <div id="chainsList"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="closeChainsBtn" class="btn-secondary">Close</button>
      </div>
    </div>
  </div>

  <!-- Create/Edit Chain Modal -->
  <div id="chainEditorModal" class="modal" style="display: none;">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2 id="chainEditorTitle">Create Prompt Chain</h2>
        <span class="modal-close">&times;</span>
      </div>
      <div class="modal-body">
        <label>Chain Name:</label>
        <input type="text" id="chainName" class="modal-input" placeholder="e.g., Code Review Workflow">

        <label>Description:</label>
        <textarea id="chainDescription" class="modal-textarea" rows="2" placeholder="What does this chain do?"></textarea>

        <label>Prompts in Chain:</label>
        <div id="chainPromptsList" class="chain-prompts-list"></div>

        <button id="addPromptToChainBtn" class="btn-secondary" style="width: 100%; margin-top: 10px;">+ Add Prompt to Chain</button>
      </div>
      <div class="modal-footer">
        <button id="saveChainBtn" class="btn-primary">Save Chain</button>
        <button id="cancelChainBtn" class="btn-secondary">Cancel</button>
      </div>
    </div>
  </div>

  <!-- A/B Test Modal -->
  <div id="abTestModal" class="modal" style="display: none;">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2>ğŸ§ª A/B Test Variations</h2>
        <span class="modal-close">&times;</span>
      </div>
      <div class="modal-body">
        <p>Test different versions of your prompt to see which performs better</p>
        <div id="abTestVariants" class="ab-test-variants"></div>
        <div id="abTestResults" class="ab-test-results"></div>
      </div>
      <div class="modal-footer">
        <button id="startABTest" class="btn-primary">Start Test</button>
        <button id="closeABTest" class="btn-secondary">Close</button>
      </div>
    </div>
  </div>

  <!-- Output Comparison Modal -->
  <div id="outputCompareModal" class="modal" style="display: none;">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2>ğŸ“Š Compare Outputs</h2>
        <span class="modal-close">&times;</span>
      </div>
      <div class="modal-body">
        <div id="outputComparison" class="output-comparison">
          <div class="output-side">
            <h3>Output A</h3>
            <div id="outputA" class="output-display"></div>
          </div>
          <div class="output-side">
            <h3>Output B</h3>
            <div id="outputB" class="output-display"></div>
          </div>
        </div>
        <div id="comparisonStats" class="comparison-stats"></div>
      </div>
      <div class="modal-footer">
        <button id="closeOutputCompare" class="btn-secondary">Close</button>
      </div>
    </div>
  </div>

  <!-- API Settings Modal -->
  <div id="apiSettingsModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ğŸ”‘ API Settings</h2>
        <span class="modal-close">&times;</span>
      </div>
      <div class="modal-body">
        <p class="modal-description">Add API keys to enable AI-powered features (optional)</p>

        <label>Anthropic API Key:</label>
        <input type="password" id="anthropicApiKey" class="modal-input" placeholder="sk-ant-...">

        <label>OpenAI API Key:</label>
        <input type="password" id="openaiApiKey" class="modal-input" placeholder="sk-...">

        <div class="api-info">
          <p><strong>Privacy:</strong> API keys are stored locally in your browser only.</p>
          <p><strong>Features enabled:</strong> AI-powered prompt improvement, smart suggestions, mutation testing</p>
        </div>
      </div>
      <div class="modal-footer">
        <button id="saveApiSettings" class="btn-primary">Save</button>
        <button id="cancelApiSettings" class="btn-secondary">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Conversation Branches Modal -->
  <div id="branchesModal" class="modal" style="display: none;">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2>ğŸŒ³ Conversation Branches</h2>
        <span class="modal-close">&times;</span>
      </div>
      <div class="modal-body">
        <p>Explore different conversation paths (Git for AI chats)</p>
        <button id="newConversation" class="btn-primary" style="width: 100%; margin-bottom: 16px;">+ New Conversation</button>
        <div id="conversationsList" class="conversations-list"></div>
        <div id="branchVisualization" class="branch-viz"></div>
      </div>
      <div class="modal-footer">
        <button id="closeBranches" class="btn-secondary">Close</button>
      </div>
    </div>
  </div>

  <!-- Security Scan Results Modal -->
  <div id="securityScanModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ğŸ”’ Security Scan Results</h2>
        <span class="modal-close">&times;</span>
      </div>
      <div class="modal-body">
        <div id="securityScore" class="security-score"></div>
        <div id="securityIssues" class="security-issues"></div>
        <div id="securityWarnings" class="security-warnings"></div>
      </div>
      <div class="modal-footer">
        <button id="sanitizePrompt" class="btn-primary" style="display: none;">ğŸ›¡ï¸ Auto-Fix Issues</button>
        <button id="closeSecurityScan" class="btn-secondary">Close</button>
      </div>
    </div>
  </div>

  <!-- Load core modules first -->
  <script src="core-utils.js"></script>
  <script src="prompt-assistant.js"></script>
  <script src="output-manager.js"></script>
  <script src="model-router.js"></script>
  <script src="workflow-manager.js"></script>

  <!-- Main application -->
  <script src="popup.js"></script>

  <!-- Feature integration -->
  <script src="integration.js"></script>
</body>
</html>
